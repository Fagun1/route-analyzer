<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Analyzer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 300px; background: white; padding: 20px; overflow-y: auto; }
        .map { flex: 1; }
        #map { width: 100%; height: 100%; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #545b62; }
        .results { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; display: none; }
        .info { display: flex; justify-content: space-between; margin: 5px 0; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: none; }
        .toast { position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 10px 20px; border-radius: 4px; z-index: 1000; }
        .toast.error { background: #dc3545; }
        .toast.warning { background: #ffc107; color: #000; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Route Planner</h2>
            
            <div class="input-group">
                <label>Start Location</label>
                <input type="text" id="start" placeholder="Enter start address">
            </div>
            
            <div class="input-group">
                <label>End Location</label>
                <input type="text" id="end" placeholder="Enter destination">
            </div>
            
            <button class="btn" onclick="findRoute()">Find Route</button>
            <button class="btn btn-secondary" onclick="clearRoute()">Clear</button>
            
            <div class="results" id="results">
                <h3>Route Details</h3>
                <div class="info">
                    <span>Distance:</span>
                    <span id="distance">--</span>
                </div>
                <div class="info">
                    <span>Duration:</span>
                    <span id="duration">--</span>
                </div>
                <div class="info">
                    <span>Speed:</span>
                    <span id="speed">--</span>
                </div>
            </div>
        </div>
        
        <div class="map">
            <div id="map"></div>
            <div class="loading" id="loading">Calculating route...</div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Global variables
        let map, startMarker, endMarker, routeLayer;
        let startLocation = null, endLocation = null;

        // Initialize map
        function initMap() {
            map = L.map('map').setView([40.7128, -74.0060], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            routeLayer = L.layerGroup().addTo(map);
            
            map.on('click', function(e) {
                if (!startLocation) {
                    setStartLocation(e.latlng.lat, e.latlng.lng);
                } else if (!endLocation) {
                    setEndLocation(e.latlng.lat, e.latlng.lng);
                } else {
                    setStartLocation(e.latlng.lat, e.latlng.lng);
                }
            });
        }

        // Set start location
        function setStartLocation(lat, lng) {
            startLocation = { lat, lng };
            if (startMarker) map.removeLayer(startMarker);
            startMarker = L.marker([lat, lng], {color: 'green'}).addTo(map);
            startMarker.bindPopup('Start Location').openPopup();
        }

        // Set end location
        function setEndLocation(lat, lng) {
            endLocation = { lat, lng };
            if (endMarker) map.removeLayer(endMarker);
            endMarker = L.marker([lat, lng], {color: 'red'}).addTo(map);
            endMarker.bindPopup('Destination').openPopup();
        }

        // Find route
        async function findRoute() {
            if (!startLocation || !endLocation) {
                showToast('Please select both locations', 'warning');
                return;
            }

            showLoading(true);
            
            try {
                // Try OSRM routing service
                const response = await fetch(`https://router.project-osrm.org/route/v1/driving/${startLocation.lng},${startLocation.lat};${endLocation.lng},${endLocation.lat}?overview=full&geometries=geojson`);
                const data = await response.json();
                
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    displayRoute(route.geometry.coordinates);
                    displayRouteInfo(route.distance, route.duration);
                } else {
                    showToast('No route found', 'error');
                }
            } catch (error) {
                console.error('Routing error:', error);
                showToast('Routing service unavailable', 'error');
            }
            
            showLoading(false);
        }

        // Display route on map
        function displayRoute(coordinates) {
            routeLayer.clearLayers();
            const latLngs = coordinates.map(coord => [coord[1], coord[0]]);
            L.polyline(latLngs, {color: 'blue', weight: 4}).addTo(routeLayer);
            map.fitBounds(L.polyline(latLngs).getBounds());
        }

        // Display route information
        function displayRouteInfo(distance, duration) {
            const distanceKm = (distance / 1000).toFixed(1);
            const durationMin = Math.round(duration / 60);
            const speedKmh = ((distance / 1000) / (duration / 3600)).toFixed(1);
            
            document.getElementById('distance').textContent = distanceKm + ' km';
            document.getElementById('duration').textContent = durationMin + ' min';
            document.getElementById('speed').textContent = speedKmh + ' km/h';
            document.getElementById('results').style.display = 'block';
        }

        // Clear route
        function clearRoute() {
            if (startMarker) map.removeLayer(startMarker);
            if (endMarker) map.removeLayer(endMarker);
            routeLayer.clearLayers();
            startLocation = null;
            endLocation = null;
            document.getElementById('results').style.display = 'none';
            document.getElementById('start').value = '';
            document.getElementById('end').value = '';
        }

        // Show loading
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Initialize when page loads
        window.onload = initMap;
    </script>
</body>
</html>
